<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:adm="http://github.com/adminfaces"
                template="/WEB-INF/templates/template.xhtml">

    <ui:define name="head-end">

        <f:event type="preRenderComponent" listener="#{usuarioMB.carregaUsuarios()}"/>

    </ui:define>

    <ui:define name="title">
        USUÁRIOS
    </ui:define>


    <ui:define name="body">
        <p:growl id="growl" showDetail="false" sticky="false" life="2000"/>

        <h:form id="frm" prependId="false">
            <div class="box box-primary ui-sm-12 ui-md-12 ui-lg-12">
                <div class="box-header with-border">


                    <adm:breadcrumb title="Pesquisa Default"/>


                    <div id="main-buttons" class="hidden-sm hidden-xs">


                        <p:commandButton value="Cadastrar" onclick="PF('dlgCadastroUsuario').show();"
                                         process="@this" styleClass="btn-primary" icon="fa fa-plus"/>
                        <p:spacer width="5"/>

                        <p:commandButton value="Excluir" process="@this" rendered="false"
                                         icon="fa fa-trash"
                                         styleClass="btn-danger">
                        </p:commandButton>
                        <p:spacer width="5"/>

                        <div style="float: right">
                            <p:commandButton icon="fa fa-search" type="button" id="buttonPesquisarGrupo"
                                             />
                            <p:inputText value="#{grupoMB.campoBuscaGrupo}" style="width:150px"
                                         placeholder="Pesquisar Grupo"/>

                            <p:slideMenu overlay="true" trigger="buttonPesquisarGrupo" my="left top"
                                         at="left bottom" style="width:100px ; height: 95px">
                                <p:menuitem value="Por Nome"
                                            />
                                <p:menuitem value="Por Usuário"
                                            />

                                <p:menuitem value="Por Email"
                                />
                            </p:slideMenu>
                        </div>


                    </div>

                    <p:splitButton value="Salvar" update="@form"
                                   icon="fa fa-check"
                                   styleClass="hidden-md hidden-lg btn-primary">
                        <p:menuitem value="Excluir"
                                    process="@this"
                                    icon="fa fa-trash"/>
                        <p:separator/>
                        <p:menuitem value="Voltar" process="@this"
                                    icon="fa fa-close"/>
                    </p:splitButton>

                    <p:separator/>

                    <div class="ui-g ui-fluid ui-sm-12 ui-md-12 ui-lg-12">
                        <p:dataTable id="usuarios" var="usuario" value="#{usuarioMB.usuarios}" editable="true"
                                     paginator="true"
                                     paginatorPosition="bottom"
                                     paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} "
                                     currentPageReportTemplate=""
                                     rowsPerPageTemplate="5,10,15,20,30">


                            <p:ajax event="rowEdit" listener="#{usuarioMB.editarUsuario}" update="growl"/>



                            <p:column headerText="Nome">
                                <p:cellEditor>
                                    <f:facet name="output"><h:outputText value="#{usuario.nome}"/></f:facet>
                                    <f:facet name="input"><p:inputText value="#{usuario.nome}"
                                                                       style="width:100%"/></f:facet>
                                </p:cellEditor>
                            </p:column>

                            <p:column headerText="Usuário">
                                <p:cellEditor>
                                    <f:facet name="output"><h:outputText value="#{usuario.usuario}"/></f:facet>
                                    <f:facet name="input"><p:inputText value="#{usuario.usuario}"
                                                                       style="width:100%"/></f:facet>
                                </p:cellEditor>
                            </p:column>

                            <p:column headerText="Email">
                                <p:cellEditor>
                                    <f:facet name="output"><h:outputText value="#{usuario.email}"/></f:facet>
                                    <f:facet name="input"><p:inputText value="#{usuario.email}"
                                                                       style="width:100%"/></f:facet>
                                </p:cellEditor>
                            </p:column>


                            <p:column headerText="Ativo" style="text-align: center" styleClass="ui-sm-1 ui-md-1 ui-lg-1">
                                <p:cellEditor>
                                    <f:facet name="output">
                                        <h:outputText value="#{usuario.ativo == true ? 'SIM' : 'NÃO'}"
                                                      styleClass="#{usuario.ativo ? 'btn-success' : 'btn-danger'}"/>
                                    </f:facet>
                                    <f:facet name="input">
                                        <div align="center">
                                            <p:selectBooleanButton onLabel="Desativar" offLabel="Ativar"
                                                                   value="#{usuario.ativo}"
                                                                   style="width:80%; text-align: center"/>
                                        </div>
                                    </f:facet>
                                </p:cellEditor>
                            </p:column>

                            <p:column headerText="Tipo de Usuário" style="text-align: center" styleClass="ui-sm-2 ui-md-2 ui-lg-2">
                                <p:cellEditor>
                                    <f:facet name="output"><h:outputText value="#{usuario.tipoUsuario}"/></f:facet>
                                    <f:facet name="input">
                                        <p:selectOneMenu value="#{usuario.tipoUsuario}"
                                                         style="width:100% ; background-color: white">
                                            <f:selectItems value="#{usuarioMB.tiposUsuario()}" var="tipo"
                                                           itemLabel="#{tipo}" itemValue="#{tipo}"/>
                                        </p:selectOneMenu>
                                    </f:facet>
                                </p:cellEditor>
                            </p:column>


                            <p:column headerText="Grupos" style="text-align: center ; width: 150px">
                                <p:commandLink value="Editar Grupos"
                                               action="#{usuarioMB.carregaGruposUsuario()}"
                                               oncomplete="PF('dlgGrupos').show();" update="dialogGrupos">
                                                <f:setPropertyActionListener value="#{usuario}"
                                                                        target="#{usuarioMB.usuarioSelecionado}"/>

                                </p:commandLink>
                            </p:column>


                            <p:column style="width:35px">
                                <p:rowEditor editTitle="Editar" cancelTitle="Cancelar" saveTitle="Salvar"/>
                            </p:column>



                            <p:column style="width:50px;">
                                <p:commandButton icon="fa fa-trash" styleClass="btn-danger btn-xs"
                                                 title="Excluir">
                                    <p:confirm header="ATENÇÃO" message="Confirma exclusão?"
                                               icon="fa fa-exclamation-triangle"/>

                                </p:commandButton>
                                <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                                    <p:commandButton value="SIM" styleClass="ui-confirmdialog-yes btn-success"
                                                     icon="fa fa-check">
                                    </p:commandButton>
                                    <p:commandButton value="NÃO" type="button"
                                                     styleClass="ui-confirmdialog-no btn-danger"
                                                     icon="fa fa-times"/>
                                </p:confirmDialog>
                            </p:column>


                        </p:dataTable>

                    </div>


                </div>


            </div>

            <p:dialog header="EDIÇÃO DE GRUPOS" modal="true" showEffect="fade" widgetVar="dlgGrupos" resizable="false"
                      id="dialogGrupos">

                <h:form id="formGrupos">

                    <p:panel>

                        <f:facet name="header">
                            Usuário - #{usuarioMB.usuarioSelecionado.nome}
                        </f:facet>

                        <p:pickList id="pickList" value="#{usuarioMB.grupos}" var="grupo" itemLabel="#{grupo.nome}"
                                    itemValue="#{grupo}" converter="GrupoConverter"
                                    showSourceFilter="true" showTargetFilter="true" filterMatchMode="contains"
                                    showCheckbox="true">

                            <f:facet name="sourceCaption">Grupos disponíves</f:facet>
                            <f:facet name="targetCaption">Grupos do Usuário</f:facet>


                            <p:ajax event="transfer" update="@this"/>

                            <p:column style="width:85%;">
                                <h:outputText value="#{grupo.nome}"/>
                            </p:column>


                        </p:pickList>


                        <f:facet name="footer">
                            <div align="center">
                                <p:commandButton value="FINALIZAR" style="width: 60%" styleClass="btn-success"
                                                 action="#{usuarioMB.atualizaGrupos()}"  process="@this"/>

                            </div>
                        </f:facet>

                    </p:panel>


                </h:form>

            </p:dialog>


            <p:dialog header="CADASTRO" widgetVar="dlgCadastroUsuario" modal="true">
                <h:form id="formCadastroUsuario">
                    <p:panelGrid columns="2">
                        <f:facet name="header">
                            <p:outputLabel value="USUÁRIO"/>


                        </f:facet>

                        <p:panelGrid columns="2">

                            <p:selectOneMenu appendTo="@this" style="width: 100%"
                                             value="#{usuarioMB.novoUsuario.tipoUsuario}">
                                <f:selectItem itemLabel="Tipo de Usuário" noSelectionOption="true"/>
                                <f:selectItems value="#{usuarioMB.tiposUsuario()}" var="tipo"
                                               itemValue="#{tipo}"/>
                            </p:selectOneMenu>

                            <p:inputText placeholder="Nome" value="#{usuarioMB.novoUsuario.nome}"/>
                            <p:inputText placeholder="Usuario" value="#{usuarioMB.novoUsuario.usuario}"/>
                            <p:inputText placeholder="Email" value="#{usuarioMB.novoUsuario.email}"/>
                            <p:password placeholder="Senha" value="#{usuarioMB.novoUsuario.senha}"/>


                            <p:selectBooleanButton value="#{usuarioMB.novoUsuario.ativo}"
                                                   onLabel="ATIVO"
                                                   offLabel="INATIVO" style="width:100%"/>


                        </p:panelGrid>


                        <f:facet name="footer">

                            <div align="center">
                                <p:commandButton value="SALVAR" style="width: 50%" update="usuarios" process="formCadastroUsuario"
                                                 styleClass="btn-success" action="#{usuarioMB.cadastrarUsuario()}"
                                />

                            </div>
                        </f:facet>

                    </p:panelGrid>

                </h:form>
            </p:dialog>


        </h:form>


    </ui:define>

</ui:composition>


        <!--                            <p:column headerText="Grupos">-->
        <!--                                <p:cellEditor>-->
        <!--                                    <f:facet name="output"><h:outputText value="Grupos"/></f:facet>-->
        <!--                                    <f:facet name="input">-->
        <!--                                        <p:selectCheckboxMenu converter="omnifaces.SelectItemsConverter"-->
        <!--                                                              label="Clique para visualizar" style=" background-color: white ;-->
        <!--                                                              height: 32px" styleClass="form-control"-->
        <!--                                                              value="#{usuario.grupos}">-->
        <!--                                            <f:selectItems value="#{grupoMB.grupos}"/>-->
        <!--                                        </p:selectCheckboxMenu>-->

        <!--                                    </f:facet>-->
        <!--                                </p:cellEditor>-->
        <!--                            </p:column>-->


        <!--<p:selectOneMenu-->
        <!--converter="omnifaces.SelectItemsConverter"-->
        <!--filter="true" filterMatchMode="startsWith">-->
        <!--<f:selectItem itemLabel="VER GRUPOS" noSelectionOption="true"/>-->
        <!--<f:selectItems value="#{usuario.grupos}"/>-->
        <!--</p:selectOneMenu>-->