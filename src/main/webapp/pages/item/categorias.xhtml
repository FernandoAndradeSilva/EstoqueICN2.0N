<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core" xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui" xmlns:adm="http://github.com/adminfaces"
                template="/WEB-INF/templates/template.xhtml">

    <ui:define name="title">
        Categorias
    </ui:define>

    <ui:define name="head-end">

    </ui:define>


    <ui:define name="body">
        <f:metadata>

        </f:metadata>
        <p:growl id="growl" showDetail="true" sticky="true"/>

        <h:form id="formCategorias" prependId="false">
            <div class="box box-primary ui-sm-12 ui-md-12 ui-lg-12">
                <div class="box-header with-border">


                    <adm:breadcrumb title="Cadastro Default" link="cadastro-default.xhtml?id="/>


                    <p:focus/>

                    <div id="main-buttons" class="hidden-sm hidden-xs">
                        <p:splitButton value="Cadastrar" type="button" update="@none" process="@none"
                                       icon="fa fa-plus" styleClass="btn-primary">

                            <p:menuitem value="CATEGORIA" onclick="PF('dlgCadastroCategoria').show();"
                                        process="@this"
                                        icon="fa fa-plus-circle"/>
                            <p:separator/>
                            <p:menuitem value="TIPO" onclick="PF('dlgCadastroTipo').show();"
                                        process="@this"
                                        icon="fa fa-plus-circle"/>

                        </p:splitButton>
                        <p:spacer width="5"/>


                        <p:commandButton value="Voltar" immediate="true"
                                         action="cadastro?faces-redirect=true"
                                         process="@this"
                                         icon="fa fa-close"/>
                    </div>


                    <p:separator/>


                    <p:dataTable var="categoria" value="#{categoriaMB.categorias}" id="categorias"
                                 rowExpandMode="single" style="height: he"

                                 editable="true">

                        <f:facet name="header">
                            CATEGORIAS
                        </f:facet>

                        <p:ajax event="rowEdit" listener="#{categoriaMB.editarCategoria}"/>

                        <p:ajax event="rowToggle" listener="#{categoriaMB.selecionaCategoria(categoria)}"
                                update="categorias:tipos"/>


                        <p:column style="width:5%">
                            <p:rowToggler/>
                        </p:column>

                        <p:column headerText="Nome">
                            <p:cellEditor>
                                <f:facet name="output"><p:outputLabel value="#{categoria.nome}"/></f:facet>
                                <f:facet name="input"><p:inputText value="#{categoria.nome}"
                                                                   style="width:100%"/></f:facet>
                            </p:cellEditor>
                        </p:column>

                        <p:column headerText="Id">
                            <p:cellEditor>
                                <f:facet name="output"><p:outputLabel value="#{categoria.id}"/></f:facet>
                                <f:facet name="input"><p:inputText value="#{categoria.id}"
                                                                   style="width:100%"/></f:facet>
                            </p:cellEditor>
                        </p:column>


                        <p:column style="width:35px">
                            <p:rowEditor editTitle="Editar" saveTitle="Salvar Alterações" cancelTitle="Cancelar"/>
                        </p:column>

                        <p:column style="width:50px;" >
                            <p:commandButton icon="fa fa-trash" styleClass="btn-danger btn-xs"
                                             title="Excluir" update="categorias"
                                             action="#{categoriaMB.excluirCategoria()}">
                                <f:setPropertyActionListener value="#{categoria}"
                                                             target="#{categoriaMB.novaCategoria}"/>
                            </p:commandButton>
                        </p:column>


                        <p:column style="width:50px;">

                            <p:commandButton title="Cadastrar tipo" styleClass="btn-xs btn-primary"
                                             icon="fa fa-plus" oncomplete="PF('dlgCadastroTipo').show();"
                                             update="formCadastroTipo , DialogCadastroTipo"
                                             action="#{categoriaMB.selecionaCategoriaNovoTipo()}">

                                <f:setPropertyActionListener value="#{categoria}"
                                                             target="#{categoriaMB.categoria}"/>
                            </p:commandButton>


                        </p:column>

                        <p:rowExpansion>


                            <div class="ui-sm-6 ui-md-6 ui-lg-6">


                                <p:dataTable id="tipos" var="tipo" value="#{categoriaMB.categoria.tipos}"
                                             editable="true"
                                             style="margin-bottom:20px">
                                    <f:facet name="header">
                                        TIPOS ASSOCIADOS A CATEGORIA #{categoriaMB.categoria.nome}
                                    </f:facet>


                                    <p:ajax event="rowEdit" update="tipos" listener="#{categoriaMB.editarTipo}"/>


                                    <p:column headerText="Nome">
                                        <p:cellEditor>
                                            <f:facet name="output"><p:outputLabel value="#{tipo.nome}"/></f:facet>
                                            <f:facet name="input"><p:inputText value="#{tipo.nome}" style="width:100%"/></f:facet>
                                        </p:cellEditor>
                                    </p:column>

                                    <p:column headerText="Id">
                                        <p:cellEditor>
                                            <f:facet name="output"><p:outputLabel value="#{tipo.id}"/></f:facet>
                                            <f:facet name="input"><p:inputText value="#{tipo.id}"
                                                                               style="width:100%"/></f:facet>
                                        </p:cellEditor>
                                    </p:column>


                                    <p:column style="width:35px">
                                        <p:rowEditor editTitle="Editar" saveTitle="Salvar Alterações"
                                                     cancelTitle="Cancelar"/>
                                    </p:column>

                                    <p:column style="width:50px;">
                                        <p:commandButton icon="fa fa-trash" styleClass="btn-danger btn-sm"
                                                         title="Excluir" update="categorias , tipos"
                                                         action="#{categoriaMB.excluirTipo()}">
                                            <f:setPropertyActionListener value="#{tipo}"
                                                                         target="#{categoriaMB.tipo}"/>
                                        </p:commandButton>
                                    </p:column>

                                </p:dataTable>

                                <p:commandButton value="Add new row" styleClass="ui-priority-primary" process="@this"
                                                 action="#{categoriaMB.onAddNew()}" update="tipos" />

                            </div>
                        </p:rowExpansion>
                    </p:dataTable>

                </div>
            </div>


        </h:form>

        <p:dialog header="CADASTRO" widgetVar="dlgCadastroTipo" modal="true" id="DialogCadastroTipo">

            <h:form id="formCadastroTipo">
                <p:panelGrid columns="2">
                    <f:facet name="header">
                        <p:outputLabel value="TIPO"/>
                    </f:facet>


                    <p:outputLabel value="Categoria: "/>
                    <p:selectOneMenu height="100" appendTo="@this" id="CategoriasNovoTipo"
                                     value="#{categoriaMB.categoria}"
                                     converter="omnifaces.SelectItemsConverter">
                        <f:selectItem itemLabel="Selecione" noSelectionOption="true"/>
                        <f:selectItems value="#{categoriaMB.categorias}"/>
                    </p:selectOneMenu>


                    <p:outputLabel value="Sigla: "/>
                    <p:inputText maxlength="2" styleClass="form-control"
                                 value="#{categoriaMB.tipo.sigla}"/>
                    <p:outputLabel value="Descricao: "/>
                    <p:inputText value="#{categoriaMB.tipo.nome}"/>


                    <f:facet name="footer">
                        <p:commandButton value="SALVAR" style="width: 100%"
                                         action="#{categoriaMB.salvarTipo()}" styleClass="btn-primary"
                                         update="@form , formCategorias"/>
                    </f:facet>

                </p:panelGrid>
            </h:form>
        </p:dialog>


        <p:dialog header="CADASTRO" widgetVar="dlgCadastroCategoria" modal="true">
            <h:form id="formCadastroCategoria">
                <p:panelGrid columns="2">
                    <f:facet name="header">
                        <p:outputLabel value="CATEGORIA"/>
                    </f:facet>

                    <p:outputLabel value="Sigla: "/>
                    <p:inputText maxlength="2" value="#{categoriaMB.novaCategoria.sigla}"
                                 styleClass="form-control" required="true"/>
                    <p:outputLabel value="Descricao: "/>
                    <p:inputText value="#{categoriaMB.novaCategoria.nome}"/>


                    <f:facet name="footer">
                        <p:commandButton value="SALVAR" style="width: 100%"
                                         action="#{categoriaMB.salvarCategoria()}" styleClass="btn-primary"
                                         update="@form , formCategorias , formCadastroTipo , growl"/>
                    </f:facet>

                </p:panelGrid>

            </h:form>
        </p:dialog>


        <h:outputScript library="js" name="script.js"/>

    </ui:define>

</ui:composition>