<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core" xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui" xmlns:adm="http://github.com/adminfaces"
                template="/WEB-INF/templates/template.xhtml">

    <ui:define name="title">
        CATEGORIAS
    </ui:define>

    <ui:define name="head-end">
        <style type="text/css">


        </style>

        <f:event type="preRenderComponent" listener="#{categoriaMB.carregaTodasCategorias()}"/>

    </ui:define>


    <ui:define name="body">
        <f:metadata>

        </f:metadata>
        <p:growl id="growl" showDetail="true" sticky="true"/>

        <h:form id="formCategorias" prependId="false">
            <div class="box box-primary ui-sm-12 ui-md-12 ui-lg-12">
                <div class="box-header with-border">


                    <adm:breadcrumb title="Cadastro Default" link="cadastro-default.xhtml?id="/>


                    <p:focus/>

                    <div id="main-buttons" class="hidden-sm hidden-xs">



                        <p:splitButton value="Cadastrar" type="button"
                                       icon="fa fa-plus" styleClass="btn-primary" >

                            <p:menuitem value="CATEGORIA" onclick="PF('dlgCadastroCategoria').show();"
                                        process="@this"/>

                            <p:menuitem value="TIPO" onclick="PF('dlgCadastroTipo').show();"
                                        process="@this"/>

                        </p:splitButton>
                        <p:spacer width="5"/>
                        <p:commandButton value="Voltar" immediate="true"
                                         action="cadastro?faces-redirect=true"
                                         process="@this"
                                         icon="fa fa-close"/>


                        <div style="float: right">


                            <p:inputText value="#{categoriaMB.campoBuscaCategoria}" style="width:150px"
                                         placeholder="Pesquisar Categoria"/>
                            <p:commandButton icon="fa fa-search" type="button" id="buttonPesquisarCategoria"
                                             update="categorias"/>

                            <p:slideMenu overlay="true" trigger="buttonPesquisarCategoria" my="left top"
                                         at="left bottom" style="width:100px ; height: 70px">
                                <p:menuitem value="SIGLA" update="categorias" action="#{categoriaMB.buscaManualCategoria(1)}" />
                                <p:menuitem value="NOME" update="categorias" action="#{categoriaMB.buscaManualCategoria(2)}"  />
                            </p:slideMenu>
                        </div>
                    </div>


                    <p:separator/>


                    <p:dataTable var="categoria" value="#{categoriaMB.categorias}" id="categorias"
                                 rowExpandMode="single" widgetVar="categorias"

                                 editable="true">

                        <f:facet name="header">

                        </f:facet>


                        <p:ajax event="rowEdit" listener="#{categoriaMB.editarCategoria}"/>

                        <p:ajax event="rowToggle" listener="#{categoriaMB.selecionaCategoria(categoria)}"
                                update="categorias:tipos"/>


                        <p:column style="width:50px">
                            <p:rowToggler/>
                        </p:column>

                        <p:column headerText="Nome">
                            <p:cellEditor>
                                <f:facet name="output"><p:outputLabel value="#{categoria.nome}"/></f:facet>
                                <f:facet name="input"><p:inputText value="#{categoria.nome}"
                                                                   style="width:100%"/></f:facet>
                            </p:cellEditor>
                        </p:column>

                        <p:column headerText="Id">
                            <p:cellEditor>
                                <f:facet name="output"><p:outputLabel value="#{categoria.id}"/></f:facet>
                                <f:facet name="input"><p:inputText value="#{categoria.id}"
                                                                   style="width:100%"/></f:facet>
                            </p:cellEditor>
                        </p:column>


                        <p:column style="width:35px">
                            <p:rowEditor editTitle="Editar" saveTitle="Salvar Alterações" cancelTitle="Cancelar"/>
                        </p:column>

                        <p:column style="width:50px;">
                            <p:commandButton icon="fa fa-trash" styleClass="btn-danger btn-xs"
                                             title="Excluir" update="categorias"
                                             action="#{categoriaMB.excluirCategoria()}">
                                <f:setPropertyActionListener value="#{categoria}"
                                                             target="#{categoriaMB.novaCategoria}"/>
                                <p:confirm header="ATENÇÃO" message="Confirma exclusão?"
                                           icon="fa fa-exclamation-triangle"/>

                            </p:commandButton>

                            <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                                <p:commandButton value="SIM" styleClass="ui-confirmdialog-yes btn-success"
                                                 icon="fa fa-check">
                                </p:commandButton>
                                <p:commandButton value="NÃO" type="button"
                                                 styleClass="ui-confirmdialog-no btn-danger"
                                                 icon="fa fa-times"/>
                            </p:confirmDialog>



                        </p:column>

                        <p:rowExpansion>


                            <div class="ui-sm-6 ui-md-6 ui-lg-6"
                                 style="float: left ; max-height: 260px ; overflow: auto">


                                <p:dataTable id="tipos" var="tipo" value="#{categoriaMB.categoria.tipos}"
                                             editable="true" widgetVar="tipos"
                                             style="margin-bottom:20px">
                                    <f:facet name="header">
                                        <div class="ui-grid-row">
                                            <p:outputPanel style="float: left ; margin-top: 8px">
                                                <p:outputLabel
                                                        value="TIPOS ASSOCIADOS A CATEGORIA #{categoriaMB.categoria.nome}"/>
                                            </p:outputPanel>

                                            <p:outputPanel id="pnl" style="float: right">
                                                <p:inputText value="#{categoriaMB.campoBuscaTipo}" style="width:150px"
                                                             placeholder="Pesquisar Tipo"/>
                                                <p:commandButton icon="fa fa-search" id="buttonPesquisaTipo"
                                                                 type="button"
                                                                 update="tipos"/>
                                                <p:commandButton icon="fa fa-refresh" update="tipos"
                                                                 action="#{categoriaMB.recarregarBusca()}"/>

                                                <p:slideMenu overlay="true" trigger="buttonPesquisaTipo" my="left top"
                                                             at="left bottom" style="width:100px ; height: 70px">
                                                    <p:menuitem value="SIGLA" action="#{categoriaMB.buscaManualTipo(1)}"
                                                                update="tipos"/>
                                                    <p:menuitem value="NOME" action="#{categoriaMB.buscaManualTipo(2)}"
                                                                update="tipos"/>
                                                </p:slideMenu>
                                            </p:outputPanel>
                                        </div>
                                    </f:facet>


                                    <p:ajax event="rowEdit" update="tipos" listener="#{categoriaMB.editarTipo}"/>

                                    <p:column headerText="Id">
                                        <p:cellEditor>
                                            <f:facet name="output"><p:outputLabel value="#{tipo.id}"/></f:facet>
                                            <f:facet name="input"><p:inputText value="#{tipo.id}"
                                                                               style="width:100%"/></f:facet>
                                        </p:cellEditor>
                                    </p:column>

                                    <p:column headerText="Sigla">
                                        <p:cellEditor>
                                            <f:facet name="output"><p:outputLabel value="#{tipo.sigla}"/></f:facet>
                                            <f:facet name="input"><p:inputText value="#{tipo.sigla}"
                                                                               style="width:100%"/></f:facet>
                                        </p:cellEditor>
                                    </p:column>

                                    <p:column headerText="Nome">
                                        <p:cellEditor>
                                            <f:facet name="output"><p:outputLabel value="#{tipo.nome}"/></f:facet>
                                            <f:facet name="input"><p:inputText value="#{tipo.nome}" style="width:100%"/></f:facet>
                                        </p:cellEditor>
                                    </p:column>


                                    <p:column style="width:35px">
                                        <p:rowEditor editTitle="Editar" saveTitle="Salvar Alterações"
                                                     cancelTitle="Cancelar"/>
                                    </p:column>

                                    <p:column style="width:50px;">
                                        <p:commandButton icon="fa fa-trash" styleClass="btn-danger btn-sm"
                                                         title="Excluir" update="tipos"
                                                         action="#{categoriaMB.atualizaExclusao()}">
                                            <f:setPropertyActionListener value="#{tipo}"
                                                                         target="#{categoriaMB.tipo}"/>
                                            <p:confirm header="ATENÇÃO" message="Confirma exclusão?"
                                                       icon="fa fa-exclamation-triangle"/>
                                        </p:commandButton>

                                        <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                                            <p:commandButton value="SIM" styleClass="ui-confirmdialog-yes btn-success"
                                                             icon="fa fa-check">
                                                <p:ajax event="click" listener="#{categoriaMB.excluirTipo(tipo)}"
                                                        update="tipos"/>
                                            </p:commandButton>
                                            <p:commandButton value="NÃO" type="button"
                                                             styleClass="ui-confirmdialog-no btn-danger"
                                                             icon="fa fa-times"/>
                                        </p:confirmDialog>

                                    </p:column>

                                </p:dataTable>

                            </div>


                            <div class="ui-sm-5 ui-md-5 ui-lg-5" style="float: left">


                                <p:panelGrid columns="3">

                                    <f:facet name="header">
                                        ADICIONAR TIPO

                                    </f:facet>

                                    <p:inputText placeholder="Sigla"
                                                 maxlength="2" styleClass="form-control"
                                                 value="#{categoriaMB.tipo.sigla}" id="campoSigla"/>

                                    <p:inputText placeholder="Nome" styleClass="form-control"
                                                 value="#{categoriaMB.tipo.nome}" id="campoNome"
                                    />


                                    <p:commandButton icon="fa fa-save" style="width: 100%" value="Salvar"
                                                     styleClass="ui-priority-primary btn-success form-control"
                                                     action="#{categoriaMB.adicionaNovoTipo()}"
                                                     update="tipos , categorias:0:campoNome , categorias:0:campoSigla">
                                        <p:resetInput target="categorias:0:campoNome"/>
                                        <p:resetInput target="categorias:0:campoSigla"/>
                                    </p:commandButton>

                                </p:panelGrid>


                            </div>

                        </p:rowExpansion>


                    </p:dataTable>


                </div>
            </div>


        </h:form>

        <p:dialog header="CADASTRO" widgetVar="dlgCadastroTipo" modal="true" id="DialogCadastroTipo">

            <h:form id="formCadastroTipo">
                <p:panelGrid columns="2">
                    <f:facet name="header">
                        <p:outputLabel value="TIPO"/>
                    </f:facet>


                    <p:outputLabel value="Categoria: "/>
                    <p:selectOneMenu height="100" appendTo="@this" id="CategoriasNovoTipo"
                                     value="#{categoriaMB.categoria}"
                                     converter="omnifaces.SelectItemsConverter">
                        <f:selectItem itemLabel="Selecione" noSelectionOption="true"/>
                        <f:selectItems value="#{categoriaMB.categorias}"/>
                    </p:selectOneMenu>


                    <p:outputLabel value="Sigla: "/>
                    <p:inputText maxlength="2" styleClass="form-control"
                                 value="#{categoriaMB.tipo.sigla}"/>
                    <p:outputLabel value="Descricao: "/>
                    <p:inputText value="#{categoriaMB.tipo.nome}"/>


                    <f:facet name="footer">
                        <p:commandButton value="SALVAR" style="width: 100%"
                                         action="#{categoriaMB.salvarTipo()}" styleClass="btn-primary"
                                         update="@form , formCategorias"/>
                    </f:facet>

                </p:panelGrid>
            </h:form>
        </p:dialog>


        <p:dialog header="CADASTRO" widgetVar="dlgCadastroCategoria" modal="true">
            <h:form id="formCadastroCategoria">
                <p:panelGrid columns="2">
                    <f:facet name="header">
                        <p:outputLabel value="CATEGORIA"/>
                    </f:facet>

                    <p:outputLabel value="Sigla: "/>
                    <p:inputText maxlength="2" value="#{categoriaMB.novaCategoria.sigla}"
                                 styleClass="form-control" required="true"/>
                    <p:outputLabel value="Descricao: "/>
                    <p:inputText value="#{categoriaMB.novaCategoria.nome}"/>


                    <f:facet name="footer">
                        <p:commandButton value="SALVAR" style="width: 100%"
                                         action="#{categoriaMB.salvarCategoria()}" styleClass="btn-primary"
                                         update="@form , formCategorias , formCadastroTipo , growl"/>
                    </f:facet>

                </p:panelGrid>

            </h:form>
        </p:dialog>


        <h:outputScript library="js" name="script.js"/>

    </ui:define>

</ui:composition>